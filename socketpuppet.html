<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criador de Perfis (Socket Puppet) - Investiga Digital</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --border-color: #dee2e6;
            --text-color: #212529;
            --muted-text-color: #6c757d;
            --accent-color: #0d6efd;
            --accent-dark: #0b5ed7;
            --success-color: #198754;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --font-primary: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-primary);
            font-weight: 400;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        .site-header {
            width: 100%;
            background-color: var(--card-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            padding: 1rem 2rem;
            margin-bottom: 3rem;
            box-sizing: border-box;
            text-align: left;
        }

        .site-header .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
        }
        .site-header .logo i {
            color: var(--accent-color);
            margin-right: 0.5rem;
        }

        .container {
            max-width: 1100px;
            width: 100%;
            padding: 0 2rem;
            box-sizing: border-box;
            flex-grow: 1;
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        h3 {
             font-size: 1.1rem;
             font-weight: 600;
             margin-top: 1.5rem;
             margin-bottom: 0.8rem;
        }

        .subtitle {
            color: var(--muted-text-color);
            font-size: 1.2rem;
            margin-bottom: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        
        .section {
            background-color: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px var(--shadow-color);
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 0.8rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: var(--font-primary);
            font-size: 1rem;
            background-color: #fff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15);
        }
        
        .radio-group, .checkbox-group {
            margin-bottom: 1rem;
        }

        .radio-group label, .checkbox-group label {
            font-weight: normal;
            display: inline-flex;
            align-items: center;
            margin-right: 1.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        input[type="radio"], input[type="checkbox"] {
            margin-right: 0.5rem;
            accent-color: var(--accent-color);
            width: 1.1em;
            height: 1.1em;
        }
        
        button {
            background-color: var(--accent-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-primary);
            transition: background-color 0.2s ease;
            width: 100%;
        }

        button:hover {
            background-color: var(--accent-dark);
        }

        button:disabled {
            background-color: #aeb8c4;
            cursor: not-allowed;
        }
        
        .info-text {
            font-size: 0.9em;
            color: var(--muted-text-color);
            margin-top: -0.5rem;
            margin-bottom: 1rem;
        }
        
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: var(--card-color); margin: 10% auto; padding: 2rem; border: 1px solid var(--border-color); width: 90%; max-width: 600px; border-radius: 12px; position: relative;
        }
        
        .terms-acceptance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .terms-checkbox-group {
            display: flex;
            align-items: center;
        }

        .terms-checkbox-group label {
            margin: 0;
            font-weight: normal;
        }
        
        .link-button {
            background: none;
            border: none;
            color: var(--accent-color);
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            font-size: 0.9rem;
            text-decoration: underline;
            width: auto;
        }
        .link-button:hover {
            color: var(--accent-dark);
            background: none;
        }
        
        .voltar-container { text-align: center; margin-top: 4rem; }
        .btn-voltar { display: inline-block; background-color: var(--muted-text-color); color: #ffffff; padding: 0.8rem 1.8rem; border-radius: 8px; text-decoration: none; font-weight: 600; transition: background-color 0.2s ease; }
        .btn-voltar:hover { background-color: var(--text-color); }
        
        footer { width: 100%; margin-top: 5rem; padding: 2rem; background-color: #212529; color: #adb5bd; font-size: 0.9rem; box-sizing: border-box; text-align: center; }
        .footer-content { max-width: 1100px; margin: 0 auto; text-align: center; }
        .footer-content p { margin: 0 0 1rem 0; }
        .security-seals { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .security-seals i { font-size: 35px; opacity: 0.7; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        #apiResult h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
            margin-top: 1.5rem;
            color: var(--accent-dark);
        }
        #apiResult ul {
            list-style-type: '✓  ';
            padding-left: 1.2rem;
        }
        #apiResult li {
            margin-bottom: 0.5rem;
        }
        .copy-section-btn {
            background-color: #e9ecef;
            color: var(--muted-text-color);
            padding: 0.3rem 0.7rem;
            font-size: 0.8rem;
            width: auto;
            border: 1px solid var(--border-color);
        }
        .copy-section-btn:hover {
            background-color: #dee2e6;
        }
        .output-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .output-actions button {
            background-color: var(--success-color);
        }

    </style>
</head>
<body>
    <header class="site-header">
        <a href="https://investigadigital.com/" class="logo">
            <i class="fa-solid fa-user-secret"></i>
            Investiga Digital
        </a>
    </header>

    <div id="termsOfUseModal" class="modal">
        <div class="modal-content">
            <h2>Termos de Uso do Criador de Perfis</h2>
            <p>Esta aplicação é uma ferramenta auxiliar para agentes de inteligência e investigadores. A funcionalidade principal é facilitar a criação de perfis fictícios ("Socket Puppets") para fins de investigação.</p>
            <p>Ao utilizar esta ferramenta, você <strong>declara-se ciente e concorda</strong> que:</p>
            <ul>
                <li>O uso da técnica "Socket Puppet" deve ser conduzido com <strong>extrema responsabilidade</strong>.</li>
                <li>Todas as ações devem <strong>respeitar as leis vigentes</strong>.</li>
                <li>A <strong>responsabilidade legal e ética</strong> pelo uso da aplicação é <strong>inteiramente sua</strong>.</li>
            </ul>
            <p><strong>Aceite estes termos para prosseguir.</strong></p>
            <button id="acceptTermsBtn">Entendido, fechar e aceitar</button>
        </div>
    </div>

    <main class="container" style="display: block;">
        <h1><i class="fa-solid fa-masks-theater"></i> Criador de Perfis (Socket Puppet)</h1>
        <p class="subtitle">Preencha as informações para gerar um dossiê completo para uma persona digital ou para memorização em missão de campo.</p>
        
        <form id="profileForm">
            <div class="section">
                <h2>1. Tipo de Perfil e Informações Básicas</h2>
                <h3>Finalidade do perfil:</h3>
                <div class="radio-group">
                    <input type="radio" id="profileTypeInternet" name="profileType" value="internet" checked> <label for="profileTypeInternet">Utilizar na internet</label>
                    <input type="radio" id="profileTypeMission" name="profileType" value="mission"> <label for="profileTypeMission">Missão de campo (memorização)</label>
                </div>

                <h3>Características Físicas, Gênero, etc.:</h3>
                <div class="radio-group">
                    <input type="radio" id="charOptionGenerate" name="charOption" value="gerar" checked> <label for="charOptionGenerate">Gerar aleatoriamente</label>
                    <input type="radio" id="charOptionProvide" name="charOption" value="fornecer"> <label for="charOptionProvide">Usar os que vou fornecer</label>
                    <input type="radio" id="charOptionNone" name="charOption" value="nao_preciso"> <label for="charOptionNone">Não preciso</label>
                </div>
                 <div id="physicalCharacteristicsSection" style="display: none;">
                    <label>Gênero:</label>
                    <select id="genderSelect"><option value="">Selecione</option><option value="Masculino">Masculino</option><option value="Feminino">Feminino</option></select>
                    
                    <div class="grid-2">
                        <div>
                            <label for="ageInput">Idade (aproximada):</label>
                            <input type="text" id="ageInput" placeholder="Ex: 25-30">
                        </div>
                        <div>
                            <label for="heightInput">Altura (cm):</label>
                            <input type="text" id="heightInput" placeholder="Ex: 175">
                        </div>
                    </div>

                    <div class="grid-2">
                        <div>
                            <label for="weightInput">Peso (kg):</label>
                            <input type="text" id="weightInput" placeholder="Ex: 70">
                        </div>
                        <div>
                            <label for="hairColorSelect">Cor do Cabelo:</label>
                            <select id="hairColorSelect">
                                <option value="">Selecione</option><option value="Preto">Preto</option><option value="Castanho">Castanho</option><option value="Loiro">Loiro</option><option value="Ruivo">Ruivo</option><option value="Grisalho">Grisalho</option><option value="Outro">Outro</option>
                            </select>
                            <input type="text" id="hairColorOther" placeholder="Especifique a cor do cabelo" style="display: none;">
                        </div>
                    </div>
                    
                    <label for="eyeColorSelect">Cor dos Olhos:</label>
                    <select id="eyeColorSelect">
                        <option value="">Selecione</option><option value="Castanho">Castanho</option><option value="Azul">Azul</option><option value="Verde">Verde</option><option value="Mel">Mel</option><option value="Outro">Outro</option>
                    </select>
                    <input type="text" id="eyeColorOther" placeholder="Especifique a cor dos olhos" style="display: none;">

                    <label for="tattoosPiercings">Tatuagens/Marcas/Cicatrizes:</label>
                    <textarea id="tattoosPiercings" placeholder="Descreva marcas distintivas." rows="2"></textarea>
                </div>
            </div>
            
            <div id="digitalPresenceSection">
                 <div class="section">
                    <h2>2. Presença Digital (Opcional)</h2>
                    <h3>Plataformas de Redes Sociais</h3>
                    <p class="info-text">Selecione para quais plataformas a IA deve gerar sugestões de perfil (nomes, bios, conteúdo inicial, etc.).</p>
                    <div class="checkbox-group">
                        <input type="checkbox" id="socialFacebook" name="socialMedia" value="Facebook"><label for="socialFacebook">Facebook</label>
                        <input type="checkbox" id="socialInstagram" name="socialMedia" value="Instagram"><label for="socialInstagram">Instagram</label>
                        <input type="checkbox" id="socialX" name="socialMedia" value="X (Twitter)"><label for="socialX">X (Twitter)</label>
                        <input type="checkbox" id="socialTikTok" name="socialMedia" value="TikTok"><label for="socialTikTok">TikTok</label>
                        <input type="checkbox" id="socialWhatsApp" name="socialMedia" value="WhatsApp"><label for="socialWhatsApp">WhatsApp</label>
                        <input type="checkbox" id="socialTelegram" name="socialMedia" value="Telegram"><label for="socialTelegram">Telegram</label>
                    </div>

                    <h3>Credenciais Fictícias</h3>
                    <div class="grid-2">
                        <div>
                            <label for="emailProviderSelect">Provedor de E-mail:</label>
                             <select id="emailProviderSelect">
                                <option value="qualquer">Qualquer um (sugestão da IA)</option>
                                <option value="Gmail">Gmail</option>
                                <option value="Outlook">Outlook</option>
                                <option value="ProtonMail">ProtonMail</option>
                             </select>
                        </div>
                        <div>
                            <label>Gerar Senha Fictícia?</label>
                             <div class="checkbox-group">
                                <input type="checkbox" id="suggestPassword" name="suggestPassword" value="sim"><label for="suggestPassword">Sim, gerar sugestão</label>
                             </div>
                        </div>
                    </div>
                     <p class="info-text" style="color: #dc3545;"><strong>Atenção:</strong> A senha sugerida é apenas para a história de cobertura. NUNCA a utilize em contas reais.</p>
                 </div>
            </div>

            <div class="section">
                <h2>3. Detalhes da Persona</h2>
                <h3>Nacionalidade e Localização</h3>
                <div class="radio-group">
                    <input type="radio" id="nationalityStandard" name="nationality" value="Brasileira" checked><label for="nationalityStandard">Brasileira (Padrão)</label>
                    <input type="radio" id="nationalityOther" name="nationality" value="Outro"><label for="nationalityOther">Outro</label>
                </div>
                <input type="text" id="otherNationality" placeholder="Digite o país. Ex: Americana" style="display: none;">

                <div id="brazilianLocationSection">
                    <label>Estado, Cidade e Região (se Brasileira):</label>
                    <div class="grid-2">
                        <select id="stateSelect"><option value="">Selecione um Estado</option><option value="AC">Acre</option><option value="AL">Alagoas</option><option value="AP">Amapá</option><option value="AM">Amazonas</option><option value="BA">Bahia</option><option value="CE">Ceará</option><option value="DF">Distrito Federal</option><option value="ES">Espírito Santo</option><option value="GO">Goiás</option><option value="MA">Maranhão</option><option value="MT">Mato Grosso</option><option value="MS">Mato Grosso do Sul</option><option value="MG">Minas Gerais</option><option value="PA">Pará</option><option value="PB">Paraíba</option><option value="PR">Paraná</option><option value="PE">Pernambuco</option><option value="PI">Piauí</option><option value="RJ">Rio de Janeiro</option><option value="RN">Rio Grande do Norte</option><option value="RS">Rio Grande do Sul</option><option value="RO">Rondônia</option><option value="RR">Roraima</option><option value="SC">Santa Catarina</option><option value="SP">São Paulo</option><option value="SE">Sergipe</option><option value="TO">Tocantins</option></select>
                        <input type="text" id="cityInput" placeholder="Cidade">
                    </div>
                     <select id="regionSelect" style="display: none; margin-top: 1rem;"><option value="">Selecione a Região/Área</option></select>
                </div>
                
                <h3>Personalidade e Estilo</h3>
                <div class="radio-group">
                     <input type="radio" id="hobbiesOptionGenerate" name="hobbiesOption" value="gerar" checked> <label for="hobbiesOptionGenerate">Gerar Hobbies/Interesses aleatoriamente</label>
                     <input type="radio" id="hobbiesOptionProvide" name="hobbiesOption" value="fornecer"> <label for="hobbiesOptionProvide">Fornecer Hobbies/Interesses</label>
                </div>
                <textarea id="hobbiesInterestsInput" placeholder="Ex: Jogos online, esportes radicais, culinária, música." rows="2" style="display:none;"></textarea>

                <div class="grid-2">
                    <div>
                         <label for="politicalViewSelect">Viés Político:</label>
                         <select id="politicalViewSelect">
                            <option value="">Selecione ou deixe em branco</option><option value="Nenhum / Apolítico">Nenhum / Apolítico</option><option value="Esquerda">Esquerda</option><option value="Centro-Esquerda">Centro-Esquerda</option><option value="Centro">Centro</option><option value="Centro-Direita">Centro-Direita</option><option value="Direita">Direita</option><option value="Liberal">Liberal</option><option value="Conservador">Conservador</option><option value="Outro">Outro (especificar)</option>
                         </select>
                         <input type="text" id="politicalViewOther" placeholder="Especifique o viés político" style="display: none;">
                    </div>
                     <div>
                        <label for="footballTeamSelect">Time de Futebol:</label>
                        <select id="footballTeamSelect">
                            <option value="">Selecione ou deixe em branco</option><option value="Não se interessa por futebol">Não se interessa por futebol</option><option value="Flamengo">Flamengo</option><option value="Corinthians">Corinthians</option><option value="São Paulo">São Paulo</option><option value="Palmeiras">Palmeiras</option><option value="Vasco da Gama">Vasco da Gama</option><option value="Grêmio">Grêmio</option><option value="Internacional">Internacional</option><option value="Cruzeiro">Cruzeiro</option><option value="Atlético-MG">Atlético-MG</option><option value="Fluminense">Fluminense</option><option value="Botafogo">Botafogo</option><option value="Outro">Outro (especificar)</option>
                        </select>
                        <input type="text" id="footballTeamOther" placeholder="Especifique o time de futebol" style="display: none;">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>4. Contexto da Operação</h2>
                <label for="targetGroupSelect">Grupo ou indivíduo alvo da investigação:</label>
                <select id="targetGroupSelect">
                    <option value="">Selecione uma opção</option><option value="Tráfico de Drogas">Tráfico de Drogas</option><option value="Estelionato / Fraudes Digitais">Estelionato / Fraudes Digitais</option><option value="Facção Criminosa">Facção Criminosa</option><option value="Grupos Radicalizados / Extremistas">Grupos Radicalizados / Extremistas</option><option value="Milícia">Milícia</option><option value="Outro">Outro (especificar)</option>
                </select>
                <input type="text" id="targetGroupOther" placeholder="Especifique o alvo da investigação" style="display: none;">

                <label for="operationObjectiveSelect">Objetivo da Operação:</label>
                <select id="operationObjectiveSelect">
                    <option value="">Selecione uma opção</option><option value="Coleta de Inteligência (Informações Gerais)">Coleta de Inteligência (Informações Gerais)</option><option value="Identificação de Membros e Hierarquia">Identificação de Membros e Hierarquia</option><option value="Mapeamento de Atividades Ilícitas">Mapeamento de Atividades Ilícitas</option><option value="Levantamento de Provas Materiais">Levantamento de Provas Materiais</option><option value="Estabelecimento de Relação de Confiança">Estabelecimento de Relação de Confiança</option><option value="Outro">Outro (especificar)</option>
                </select>
                <input type="text" id="operationObjectiveOther" placeholder="Especifique o objetivo da operação" style="display: none;">
            </div>

            <div class="section">
                <h2>5. Ocupação e Detalhes Adicionais</h2>
                <label for="knownProfessionSelect">Profissão/Ocupação:</label>
                <select id="knownProfessionSelect">
                    <option value="">Selecione uma opção</option><option value="Estudante">Estudante</option><option value="Profissional de TI / Desenvolvedor">Profissional de TI / Desenvolvedor</option><option value="Vendedor / Comerciante">Vendedor / Comerciante</option><option value="Motorista de Aplicativo / Entregador">Motorista de Aplicativo / Entregador</option><option value="Profissional Liberal (Advogado, Contador, etc.)">Profissional Liberal (Advogado, Contador, etc.)</option><option value="Desempregado">Desempregado</option><option value="Outro">Outro (especificar)</option>
                </select>
                <input type="text" id="knownProfessionInput" placeholder="Especifique a profissão/ocupação" style="display: none;">
                
                <label for="additionalNotes">Observações (sotaque, vícios, manias, etc.):</label>
                <textarea id="additionalNotes" rows="3"></textarea>
            </div>
            
            <div class="section">
                <h2>6. História de Cobertura</h2>
                 <div class="radio-group">
                    <input type="radio" id="coverStoryOptionGenerate" name="coverStoryOption" value="gerar" checked><label for="coverStoryOptionGenerate">Gerar história de cobertura</label>
                    <input type="radio" id="coverStoryOptionProvide" name="coverStoryOption" value="fornecer"><label for="coverStoryOptionProvide">Fornecer história de cobertura</label>
                </div>
                <textarea id="coverStoryInput" rows="4" placeholder="Descreva a história de cobertura aqui..." style="display: none;"></textarea>
            </div>

            <div class="section">
                <h2>7. Geração com IA</h2>
                <p class="info-text">Para gerar o perfil, insira sua chave de API do Google AI Studio. A geração é feita diretamente na página.</p>
                <label for="geminiApiKey">Sua Chave de API do Gemini (Obrigatório)</label>
                <input type="password" id="geminiApiKey" placeholder="Cole sua chave de API aqui" required>
                <p class="info-text" style="margin-top: 1rem;">Você pode obter uma chave de API gratuitamente no <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">Google AI Studio</a>.</p>
                
                <div class="terms-acceptance">
                    <div class="terms-checkbox-group">
                        <input type="checkbox" id="termsCheckbox" name="termsCheckbox">
                        <label for="termsCheckbox">Eu li e aceito os termos de uso.</label>
                    </div>
                    <button type="button" id="openTermsBtn" class="link-button">Ler os Termos</button>
                </div>
            </div>
            
            <button type="submit" id="submitBtn" disabled>Gerar Dossiê com IA</button>
        </form>

        <div id="outputContainer" style="display: none; margin-top: 2rem;" class="section">
            <h2>Dossiê Gerado</h2>
            <div id="apiResult"></div>
            <div class="output-actions">
                 <button id="saveProfileButton" style="display: none;"><i class="fa-solid fa-save"></i> Salvar Perfil (.txt)</button>
                 <button id="copyMarkdownButton" style="display: none;"><i class="fa-solid fa-clipboard"></i> Copiar como Markdown</button>
            </div>
        </div>

        <div class="voltar-container">
            <a href="https://investigadigital.com/" class="btn-voltar">← Voltar à Página Inicial</a>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; <span id="year"></span> Investiga Digital – Desenvolvido por Pedro Henrique.</p>
            <div class="security-seals">
                <i class="fa-solid fa-shield-halved" title="Site Seguro (SSL)"></i>
                <i class="fa-solid fa-lock" title="Conexão Segura"></i>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- DOM Elements ---
        const form = document.getElementById('profileForm');
        const outputContainer = document.getElementById('outputContainer');
        const termsModal = document.getElementById('termsOfUseModal');
        const acceptTermsBtn = document.getElementById('acceptTermsBtn');
        const openTermsBtn = document.getElementById('openTermsBtn');
        const termsCheckbox = document.getElementById('termsCheckbox');
        const submitBtn = document.getElementById('submitBtn');
        const apiResultDiv = document.getElementById('apiResult');
        const digitalPresenceSection = document.getElementById('digitalPresenceSection');
        const regionSelect = document.getElementById('regionSelect');
        const cityInput = document.getElementById('cityInput');
        const saveProfileButton = document.getElementById('saveProfileButton');
        const copyMarkdownButton = document.getElementById('copyMarkdownButton');
        
        let rawMarkdownResponse = '';

        const capitalRegions = {
            'São Paulo': ['Zona Leste', 'Zona Sul', 'Zona Oeste', 'Zona Norte', 'Centro', 'ABC Paulista'],
            'Rio de Janeiro': ['Zona Sul', 'Zona Norte', 'Zona Oeste (Barra, Recreio, etc.)', 'Centro', 'Baixada Fluminense'],
            'Brasília': ['Plano Piloto', 'Taguatinga', 'Ceilândia', 'Guará', 'Águas Claras'],
            'Salvador': ['Centro', 'Orla Atlântica', 'Cidade Baixa', 'Subúrbio Ferroviário'],
            'Belo Horizonte': ['Centro-Sul', 'Pampulha', 'Venda Nova', 'Barreiro']
        };

        // --- Event Listeners ---
        openTermsBtn.addEventListener('click', () => {
            if (termsModal) termsModal.style.display = 'block';
        });

        acceptTermsBtn.addEventListener('click', () => {
            if (termsModal) termsModal.style.display = 'none';
            termsCheckbox.checked = true;
            termsCheckbox.dispatchEvent(new Event('change'));
        });

        termsCheckbox.addEventListener('change', () => {
            submitBtn.disabled = !termsCheckbox.checked;
        });
        
        document.querySelector('input[name="profileType"]').addEventListener('change', (e) => {
            digitalPresenceSection.style.display = e.target.value === 'internet' ? 'block' : 'none';
        });

        cityInput.addEventListener('input', () => {
            const city = cityInput.value.trim();
            const regions = capitalRegions[city];
            regionSelect.innerHTML = '<option value="">Selecione a Região/Área</option>';
            if (regions) {
                regions.forEach(region => {
                    const option = new Option(region, region);
                    regionSelect.add(option);
                });
                regionSelect.style.display = 'block';
            } else {
                regionSelect.style.display = 'none';
            }
        });
        
        saveProfileButton.addEventListener('click', () => {
            const blob = new Blob([apiResultDiv.innerText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `perfil_socketpuppet_${Date.now()}.txt`;
            link.click();
            URL.revokeObjectURL(link.href);
        });
        
        copyMarkdownButton.addEventListener('click', () => {
            navigator.clipboard.writeText(rawMarkdownResponse).then(() => {
                const originalText = copyMarkdownButton.innerHTML;
                copyMarkdownButton.innerHTML = 'Copiado!';
                setTimeout(() => { copyMarkdownButton.innerHTML = originalText; }, 1500);
            }).catch(err => console.error('Erro ao copiar markdown: ', err));
        });

        // --- Setup Functions ---
        function setupToggle(radioGroupName, targetElementId, showWhenValueIs) {
            const radios = document.querySelectorAll(`input[name="${radioGroupName}"]`);
            const targetElement = document.getElementById(targetElementId);
            if (!targetElement) return;
            const updateVisibility = () => {
                const checkedRadio = document.querySelector(`input[name="${radioGroupName}"]:checked`);
                targetElement.style.display = (checkedRadio && checkedRadio.value === showWhenValueIs) ? 'block' : 'none';
            };
            radios.forEach(radio => radio.addEventListener('change', updateVisibility));
            updateVisibility();
        }

        function setupSelectOtherToggle(selectId, otherInputId) {
            const select = document.getElementById(selectId);
            const otherInput = document.getElementById(otherInputId);
            if (!select || !otherInput) return;
            const update = () => {
                const show = select.value.toLowerCase().includes('outro');
                otherInput.style.display = show ? 'block' : 'none';
                if (!show) otherInput.value = '';
            };
            select.addEventListener('change', update);
            update();
        }
        
        // --- Main Form Submission Logic ---
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const apiKey = document.getElementById('geminiApiKey').value.trim();
            if (!apiKey) {
                alert('Por favor, insira sua chave de API do Gemini para gerar o perfil.');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> A gerar, por favor aguarde...';
            outputContainer.style.display = 'block';
            apiResultDiv.innerHTML = ''; // Clear previous results
            saveProfileButton.style.display = 'none';
            copyMarkdownButton.style.display = 'none';
            
            const getById = (id) => document.getElementById(id).value.trim();
            const getRadio = (name) => document.querySelector(`input[name="${name}"]:checked`).value;
            
            const getSelect = (selectId, otherId) => {
                const select = document.getElementById(selectId);
                if (!select || !select.value) return '';
                if (select.value.toLowerCase().includes('outro')) {
                    const otherInput = document.getElementById(otherId);
                    return otherInput ? otherInput.value.trim() : '';
                }
                return select.value;
            };

            // --- Prompt Assembly ---
            let prompt = `**Instrução para IA:** Crie um dossiê detalhado e coeso para um perfil fictício (Socket Puppet).
**Formato de Saída OBRIGATÓRIO (siga à risca):**
- Use Markdown.
- Para seções principais, use '###' (ex: ### 👤 DADOS BÁSICOS).
- Para itens, use um marcador '-' seguido de '**Tópico:**' em negrito (ex: - **Finalidade:** Utilização na internet).
- Para sub-itens, use UMA indentação (dois espaços) e um marcador '-' (ex:
  - **Gênero:** Feminino).
- Use emojis para organizar visualmente.

---

**Parâmetros para Geração:**

`;
            
            // Section 1: Basic Info
            prompt += `### 👤 DADOS BÁSICOS E OBJETIVO\n`;
            const profileType = getRadio('profileType');
            prompt += `- **Finalidade:** ${profileType === 'internet' ? 'Utilização na internet.' : 'Missão de campo (memorização).'}\n`;
            
            const charOption = getRadio('charOption');
            if (charOption !== 'nao_preciso') {
                 if (charOption === 'gerar') {
                    prompt += `- **Características Físicas:** Gerar aleatoriamente.\n`;
                } else {
                    prompt += `- **Gênero (Fornecido):** ${getById('genderSelect') || '[Não especificado]'}\n`;
                    if (getById('ageInput')) prompt += `- **Idade (Fornecida):** ${getById('ageInput')}\n`;
                    if (getById('heightInput')) prompt += `- **Altura (Fornecida):** ${getById('heightInput')} cm\n`;
                    if (getById('weightInput')) prompt += `- **Peso (Fornecido):** ${getById('weightInput')} kg\n`;
                    const hairColor = getSelect('hairColorSelect', 'hairColorOther');
                    if (hairColor) prompt += `- **Cor do Cabelo (Fornecida):** ${hairColor}\n`;
                    const eyeColor = getSelect('eyeColorSelect', 'eyeColorOther');
                    if (eyeColor) prompt += `- **Cor dos Olhos (Fornecida):** ${eyeColor}\n`;
                    if (getById('tattoosPiercings')) prompt += `- **Marcas Distintivas (Fornecidas):** ${getById('tattoosPiercings')}\n`;
                }
            }

            // Section 2: Persona Details
            const nationality = getRadio('nationality') === 'Outro' ? getById('otherNationality') : 'Brasileira';
            prompt += `- **Nacionalidade:** ${nationality}\n`;
            if (nationality === 'Brasileira') {
                let location = `${getById('cityInput') || '[Cidade não especificada]'}, ${getById('stateSelect') || '[Estado não especificado]'}`;
                if (regionSelect.style.display === 'block' && regionSelect.value) {
                    location += ` - Região: ${regionSelect.value}`;
                }
                prompt += `- **Localização:** ${location}\n`;
            }
            const profession = getSelect('knownProfessionSelect', 'knownProfessionInput');
            prompt += `- **Profissão/Ocupação:** ${profession || '[A ser sugerida pela IA]'}\n\n`;
            
            // Section 3: Context
            prompt += `### 🎯 CONTEXTO OPERACIONAL\n`;
            const targetGroup = getSelect('targetGroupSelect', 'targetGroupOther');
            prompt += `- **Alvo da Investigação:** ${targetGroup || '[Não especificado]'}\n`;
            const operationObjective = getSelect('operationObjectiveSelect', 'operationObjectiveOther');
            prompt += `- **Objetivo da Operação:** ${operationObjective || '[Não especificado]'}\n\n`;
            
            // Section 4: Personality
            prompt += `### ✨ DETALHES COMPORTAMENTAIS E DE PERSONALIDADE\n`;
            if (getRadio('hobbiesOption') === 'fornecer') {
                prompt += `- **Hobbies e Interesses (Fornecidos):** ${getById('hobbiesInterestsInput')}\n`;
            } else {
                prompt += `- **Hobbies e Interesses:** Gerar aleatoriamente com base no perfil.\n`;
            }

            const politicalView = getSelect('politicalViewSelect', 'politicalViewOther');
            if (politicalView) prompt += `- **Viés Político:** ${politicalView}\n`;
            
            const footballTeam = getSelect('footballTeamSelect', 'footballTeamOther');
            if (footballTeam) prompt += `- **Time de Futebol:** ${footballTeam}\n`;

            prompt += `- **Observações Adicionais (manias, sotaque, etc.):** ${getById('additionalNotes') || 'Nenhuma observação específica.'}\n\n`;
            
            // Section 5: Backstory
            prompt += `### 📜 HISTÓRIA DE COBERTURA (BACKSTORY)\n`;
            if (getRadio('coverStoryOption') === 'gerar') {
                 prompt += `[A IA deve gerar uma história de cobertura detalhada e coesa, integrando todos os dados acima. A história deve justificar a profissão, localização e o motivo pelo qual o perfil estaria no ambiente de interesse da investigação, tornando a persona crível e minimizando riscos de exposição.]\n\n`;
            } else {
                prompt += `- **Base da História (Fornecida):** ${getById('coverStoryInput')}\n [A IA deve expandir e detalhar esta base para criar uma narrativa completa e coesa.]\n\n`;
            }
            
            // Section 6: Digital Presence
            if (profileType === 'internet') {
                prompt += `### 🌐 SUGESTÕES PARA PRESENÇA DIGITAL\n`;
                prompt += `- **E-mail:** Gerar sugestão de e-mail usando o provedor: ${getById('emailProviderSelect')}.\n`;
                if(document.getElementById('suggestPassword').checked) {
                    prompt += `- **Senha Fictícia:** Gerar uma senha forte para a história de cobertura (NÃO para uso real).\n`;
                }

                const selectedSocialMedia = Array.from(document.querySelectorAll('input[name="socialMedia"]:checked')).map(cb => cb.value);
                if (selectedSocialMedia.length > 0) {
                     prompt += `- **Perfis para Redes Sociais (${selectedSocialMedia.join(', ')}):** Para cada plataforma selecionada, gere sugestões detalhadas, incluindo nome de usuário, bio, estilo de foto de perfil e 3 ideias de postagens iniciais que reforcem a persona.\n`;
                }
            }

            // --- API Call ---
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    let errorMsg = `HTTP error! status: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = `Erro da API: ${errorData.error?.message || 'Resposta inválida'}`;
                    } catch (jsonError) {
                        // If the response is not JSON, use the raw text.
                        errorMsg = `Erro da API: ${await response.text()}`;
                    }
                    throw new Error(errorMsg);
                }
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    rawMarkdownResponse = text;
                    renderMarkdown(text);
                } else {
                    apiResultDiv.textContent = 'A API não retornou um resultado válido.';
                    console.log('Resposta da API incompleta:', result);
                }
            } catch (error) {
                console.error('Erro ao chamar a API Gemini:', error);
                let userMessage = `<p style="color: #dc3545;"><strong>Ocorreu um erro ao comunicar com a IA:</strong> ${error.message}.</p>`;
                if (error.message.includes('API key not valid')) {
                    userMessage += `<p><strong>Causa provável:</strong> A sua chave de API do Gemini é inválida ou foi introduzida incorretamente.</p>
                                    <p><strong>Ações recomendadas:</strong></p>
                                    <ul>
                                        <li>Verifique se copiou a chave de API completa e sem espaços extra.</li>
                                        <li>Crie uma nova chave de API no <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">Google AI Studio</a>.</li>
                                    </ul>`;
                } else {
                    userMessage += `<p>Por favor, verifique a sua ligação à internet e tente novamente.</p>`;
                }
                apiResultDiv.innerHTML = userMessage;
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Gerar Dossiê com IA';
            }
            
            saveProfileButton.style.display = 'block';
            copyMarkdownButton.style.display = 'block';
            outputContainer.scrollIntoView({ behavior: 'smooth' });
        });
        
        // --- Rendering & Utility Functions ---
        function renderMarkdown(markdown) {
            const lines = markdown.split('\n');
            let html = '';
            let listLevel = -1; // -1 means no list, 0 is root, 2 is one level in, etc.

            function processLine(line) {
                return line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            }

            lines.forEach(line => {
                if (line.trim() === '') return;

                const indent = line.search(/\S|$/);
                const isListItem = line.trim().startsWith('- ');

                if (line.trim().startsWith('### ')) {
                    // Close any open lists before a new header
                    while (listLevel >= 0) {
                        html += '</ul>';
                        if(listLevel > 0) html += '</li>';
                        listLevel -= 2;
                    }
                    html += `<h4>${processLine(line.trim().substring(4))}</h4>`;
                    listLevel = -1;
                    return;
                }

                if (isListItem) {
                    // Go shallower
                    while (indent < listLevel) {
                        html += '</ul></li>';
                        listLevel -= 2;
                    }
                    // Start new list or go deeper
                    if (indent > listLevel) {
                         // remove closing </li> of parent to nest the ul
                        if(html.endsWith('</li>')) {
                           html = html.slice(0, -5);
                        }
                        html += '<ul>';
                        listLevel += 2;
                    }
                    html += `<li>${processLine(line.trim().substring(2))}</li>`;
                } else {
                    // Close any open lists if it's not a list item
                    while (listLevel >= 0) {
                        html += '</ul>';
                         if(listLevel > 0) html += '</li>';
                        listLevel -= 2;
                    }
                    html += `<p>${processLine(line)}</p>`;
                    listLevel = -1;
                }
            });

            // Close any remaining lists
            while (listLevel >= 0) {
                html += '</ul>';
                if(listLevel > 0) html += '</li>';
                listLevel -= 2;
            }
            
            apiResultDiv.innerHTML = html;

            apiResultDiv.querySelectorAll('h4').forEach(h4 => {
                const btn = document.createElement('button');
                btn.className = 'copy-section-btn';
                btn.innerHTML = '<i class="fa-solid fa-copy"></i> Copiar';
                btn.onclick = () => {
                    let contentToCopy = [];
                    let nextElem = h4.nextElementSibling;
                    while (nextElem && nextElem.tagName !== 'H4') {
                        contentToCopy.push(nextElem.innerText);
                        nextElem = nextElem.nextElementSibling;
                    }
                    navigator.clipboard.writeText(h4.innerText + '\n\n' + contentToCopy.join('\n')).then(() => {
                         const originalText = btn.innerHTML;
                         btn.innerHTML = 'Copiado!';
                         setTimeout(() => { btn.innerHTML = originalText; }, 1500);
                    });
                };
                h4.appendChild(btn);
            });
        }
        
        // --- Initial Page Setup ---
        setupToggle('charOption', 'physicalCharacteristicsSection', 'fornecer');
        setupToggle('nationality', 'otherNationality', 'Outro');
        setupToggle('nationality', 'brazilianLocationSection', 'Brasileira');
        setupToggle('hobbiesOption', 'hobbiesInterestsInput', 'fornecer');
        setupToggle('coverStoryOption', 'coverStoryInput', 'fornecer');

        setupSelectOtherToggle('hairColorSelect', 'hairColorOther');
        setupSelectOtherToggle('eyeColorSelect', 'eyeColorOther');
        setupSelectOtherToggle('targetGroupSelect', 'targetGroupOther');
        setupSelectOtherToggle('operationObjectiveSelect', 'operationObjectiveOther');
        setupSelectOtherToggle('knownProfessionSelect', 'knownProfessionInput');
        setupSelectOtherToggle('politicalViewSelect', 'politicalViewOther');
        setupSelectOtherToggle('footballTeamSelect', 'footballTeamOther');
        
        document.getElementById('year').textContent = new Date().getFullYear();
    });
    </script>
</body>
</html>

